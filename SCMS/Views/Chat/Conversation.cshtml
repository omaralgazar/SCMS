@model SCMS.ViewModels.ChatConversationVm
@{
    ViewData["Title"] = "Conversation";
}

<div class="card">
    <div class="soft-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>💬 Chat with @Model.AgentName</div>

        <!-- End Chat -->
        <form asp-controller="Chat" asp-action="End" method="post" style="margin:0;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.ConversationId" />
            <button type="submit" class="btn btn-outline" style="border-color: var(--danger); color: var(--danger);">
                End Chat
            </button>
        </form>
    </div>

    <div style="padding:16px; height:420px; overflow-y:auto;">
        @foreach (var msg in Model.Messages)
        {
            <div style="margin-bottom:10px; display:flex; justify-content:@(msg.IsFromCurrentUser ? "flex-end" : "flex-start");">
                <div style="max-width:70%; padding:10px 12px; border-radius:12px;
                                background:@(msg.IsFromCurrentUser ? "rgba(30,136,229,.12)" : "rgba(0,0,0,.04)");">
                    <div style="font-weight:700; font-size:12px; color:var(--text-muted); margin-bottom:4px;">
                        @msg.SenderName
                        <span style="font-weight:400;">• @msg.SentAt.ToString("g")</span>
                    </div>
                    <div>@msg.Text</div>
                </div>
            </div>
        }
    </div>

    <div style="padding:16px; border-top:1px solid var(--border);">
        <form asp-controller="Chat" asp-action="Send" method="post">
            @Html.AntiForgeryToken()

            <input type="hidden" asp-for="ConversationId" />

            <textarea asp-for="NewMessageText" rows="3" class="form-control"
                      placeholder="Type your message..."></textarea>

            <button type="submit" class="btn btn-primary" style="margin-top:10px;">
                Send
            </button>
        </form>
    </div>
</div>
